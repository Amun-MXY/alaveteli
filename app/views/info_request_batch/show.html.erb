<% @title = _("{{title}} - a batch request", :title => @info_request_batch.title) %>

<% if flash[:batch_sent] %>
  <%= render :partial => 'batch_sent' %>
<% end %>

<div class="info_request_batch_intro">
  <h1><%= @title %></h1>
  <% if @info_request_batch.sent_at %>
    <%= n_('Sent to one authority by {{info_request_user}} on {{date}}.', 'Sent to {{authority_count}} authorities by {{info_request_user}} on {{date}}.', @info_request_batch.info_requests.size, :authority_count=> @info_request_batch.info_requests.size, :info_request_user => user_link(@info_request_batch.user), :date => simple_date(@info_request_batch.sent_at)) %>

</div>

<div id="left_column" class="left_column">
  <div class="results_section">
    <div class="results_block">
      <% @info_requests.each do |info_request| %>
        <%= render :partial => 'request/request_listing_via_event', :locals => { :event => info_request.last_event_forming_initial_request } %>
      <% end %>
    </div>
    <%= will_paginate WillPaginate::Collection.new(@page, @per_page, @info_request_batch.info_requests.is_searchable.count) %>
  </div>

  <% else %>
    <%= _('Created by {{info_request_user}} on {{date}}.', :info_request_user => user_link(@info_request_batch.user), :date => simple_date(@info_request_batch.created_at)) %>
    <%= _('Requests will be sent to the following bodies:') %>
    </div>
    <div class="results_section">
      <div class="results_block">
        <%= render :partial => 'public_body/body_listing',
                   :locals => { :public_bodies => @public_bodies } %>
      </div>
      <%= will_paginate WillPaginate::Collection.new(
            @page, @per_page, @info_request_batch.public_bodies.count) %>
    </div>

  <% end %>
</div>

<div id="right_column" class="sidebar right_column" role="complementary">
  <% if @info_request_batch.embargo_duration %>
  <div class="sidebar__section update-embargo">
    <h2 class="embargo-sidebar-heading">
      <i class="embargo-indicator embargo-indicator--small"></i>
      <%= _("Privacy") %>
    </h2>
    <label class="houdini-label" for="input1"><%= _("Change privacy") %></label>
    <input class="houdini-input" type="checkbox" id="input1">
    <div class="houdini-target extend-embargo-sidebar">
      <% example_embargo = @info_request_batch.info_requests.first.embargo %>
      <%= form_tag(
            create_batch_alaveteli_pro_embargo_extensions_path,
            class: 'js-embargo-form' ) do |f| %>
        <%= render partial: "alaveteli_pro/info_request_batches/embargo_info",
                   locals: { embargo: example_embargo, tense: :present } %>
        <%= hidden_field_tag :info_request_batch_id, @info_request_batch.id %>

        <p>
          <label class="form_label" for="extension_duration">
            <%= _('Keep private for a further:') %>
          </label>
          <%= select_tag :extension_duration,
                         options_for_select(
                           embargo_extension_options(example_embargo)),
                         class: 'js-embargo-duration' %>
          <input type="submit"
                 value="<%= _("Update") %>"
                 class="embargo__submit">
        </p>
      <% end %>
      <%= button_to _("Publish requests"),
                    destroy_batch_alaveteli_pro_embargoes_path(
                      info_request_batch_id: @info_request_batch.id),
                    method: :post,
                    data: {
                      confirm: _("Are you sure you want to publish these requests?")
                    } %>
    </div>
  </div>
  <% end %>
</div>
